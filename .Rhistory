rst7 <- raster(file.path(ifolder,fls[i],paste0(base,'_sr_band7.tif')))
pix <- raster(file.path(ifolder,fls[i],paste0(base,'_pixel_qa.tif')))
radsat <- raster(file.path(ifolder,fls[i],paste0(base,'_radsat_qa.tif')))
atmos <- raster(file.path(ifolder,fls[i],paste0(base,'_sr_atmos_opacity.tif')))
cloud <- raster(file.path(ifolder,fls[i],paste0(base,'_sr_cloud_qa.tif')))
crop(rst4, extent(area), filename = file.path(ifolder,'crop',paste0(base,'_sr_band4_crop.tif')))
crop(rst7, extent(area), filename = file.path(ifolder,'crop',paste0(base,'_sr_band7_crop.tif')))
crop(pix, extent(area), filename = file.path(ifolder,'crop',paste0(base,'_pixel_qa_crop.tif')))
crop(radsat, extent(area), filename = file.path(ifolder,'crop',paste0(base,'_radsat_qa_crop.tif')))
crop(atmos, extent(area), filename = file.path(ifolder,'crop',paste0(base,'_sr_atmos_opacity_crop.tif')))
crop(cloud, extent(area), filename = file.path(ifolder,'crop',paste0(base,'_sr_cloud_qa_crop.tif')))
rm(rst4, rst7,pix, radsat, atmos, cloud)
}
fls <- list.files(ifolder, pattern ='LT05*')
for(i in 1:length(fls)){
base <- tools::file_path_sans_ext(list.files(file.path(ifolder, fls[i]), pattern = '*.xml'))
rst5 <- raster(file.path(ifolder,fls[i],paste0(base,'_sr_band5.tif')))
rst7 <- raster(file.path(ifolder,fls[i],paste0(base,'_sr_band7.tif')))
pix <- raster(file.path(ifolder,fls[i],paste0(base,'_pixel_qa.tif')))
radsat <- raster(file.path(ifolder,fls[i],paste0(base,'_radsat_qa.tif')))
atmos <- raster(file.path(ifolder,fls[i],paste0(base,'_sr_aerosol.tif')))
crop(rst5, extent(area), filename = file.path(ifolder,'crop',paste0(base,'_sr_band5_crop.tif')))
crop(rst7, extent(area), filename = file.path(ifolder,'crop',paste0(base,'_sr_band7_crop.tif')))
crop(pix, extent(area), filename = file.path(ifolder,'crop',paste0(base,'_pixel_qa_crop.tif')))
crop(radsat, extent(area), filename = file.path(ifolder,'crop',paste0(base,'_radsat_qa_crop.tif')))
crop(atmos, extent(area), filename = file.path(ifolder,'crop',paste0(base,'_sr_aerosol_crop.tif')))
rm(rst4, rst7,pix, radsat, atmos)
}
fls <- list.files(ifolder, pattern ='LC08*')
for(i in 1:length(fls)){
base <- tools::file_path_sans_ext(list.files(file.path(ifolder, fls[i]), pattern = '*.xml'))
rst5 <- raster(file.path(ifolder,fls[i],paste0(base,'_sr_band5.tif')))
rst7 <- raster(file.path(ifolder,fls[i],paste0(base,'_sr_band7.tif')))
pix <- raster(file.path(ifolder,fls[i],paste0(base,'_pixel_qa.tif')))
radsat <- raster(file.path(ifolder,fls[i],paste0(base,'_radsat_qa.tif')))
atmos <- raster(file.path(ifolder,fls[i],paste0(base,'_sr_aerosol.tif')))
crop(rst5, extent(area), filename = file.path(ifolder,'crop',paste0(base,'_sr_band5_crop.tif')))
crop(rst7, extent(area), filename = file.path(ifolder,'crop',paste0(base,'_sr_band7_crop.tif')))
crop(pix, extent(area), filename = file.path(ifolder,'crop',paste0(base,'_pixel_qa_crop.tif')))
crop(radsat, extent(area), filename = file.path(ifolder,'crop',paste0(base,'_radsat_qa_crop.tif')))
crop(atmos, extent(area), filename = file.path(ifolder,'crop',paste0(base,'_sr_aerosol_crop.tif')))
rm(rst4, rst7,pix, radsat, atmos)
}
rm(rst5, rst7,pix, radsat, atmos)
#L7
fls <- list.files(ifolder, pattern ='LE07*')
for(i in 1:length(fls)){
base <- tools::file_path_sans_ext(list.files(file.path(ifolder, fls[i]), pattern = '*.xml'))
rst4 <- raster(file.path(ifolder,fls[i],paste0(base,'_sr_band4.tif')))
rst7 <- raster(file.path(ifolder,fls[i],paste0(base,'_sr_band7.tif')))
pix <- raster(file.path(ifolder,fls[i],paste0(base,'_pixel_qa.tif')))
radsat <- raster(file.path(ifolder,fls[i],paste0(base,'_radsat_qa.tif')))
atmos <- raster(file.path(ifolder,fls[i],paste0(base,'_sr_atmos_opacity.tif')))
cloud <- raster(file.path(ifolder,fls[i],paste0(base,'_sr_cloud_qa.tif')))
crop(rst4, extent(area), filename = file.path(ifolder,'crop',paste0(base,'_sr_band4_crop.tif')))
crop(rst7, extent(area), filename = file.path(ifolder,'crop',paste0(base,'_sr_band7_crop.tif')))
crop(pix, extent(area), filename = file.path(ifolder,'crop',paste0(base,'_pixel_qa_crop.tif')))
crop(radsat, extent(area), filename = file.path(ifolder,'crop',paste0(base,'_radsat_qa_crop.tif')))
crop(atmos, extent(area), filename = file.path(ifolder,'crop',paste0(base,'_sr_atmos_opacity_crop.tif')))
crop(cloud, extent(area), filename = file.path(ifolder,'crop',paste0(base,'_sr_cloud_qa_crop.tif')))
rm(rst4, rst7,pix, radsat, atmos, cloud)
}
#L7
fls <- list.files(ifolder, pattern ='LE07*')
for(i in 1:length(fls)){
base <- tools::file_path_sans_ext(list.files(file.path(ifolder, fls[i]), pattern = '*.xml'))
rst4 <- raster(file.path(ifolder,fls[i],paste0(base,'_sr_band4.tif')))
rst7 <- raster(file.path(ifolder,fls[i],paste0(base,'_sr_band7.tif')))
pix <- raster(file.path(ifolder,fls[i],paste0(base,'_pixel_qa.tif')))
radsat <- raster(file.path(ifolder,fls[i],paste0(base,'_radsat_qa.tif')))
atmos <- raster(file.path(ifolder,fls[i],paste0(base,'_sr_atmos_opacity.tif')))
cloud <- raster(file.path(ifolder,fls[i],paste0(base,'_sr_cloud_qa.tif')))
crop(rst4, extent(area), filename = file.path(ifolder,'crop',paste0(base,'_sr_band4_crop.tif')), overwrite = T)
crop(rst7, extent(area), filename = file.path(ifolder,'crop',paste0(base,'_sr_band7_crop.tif')), overwrite = T)
crop(pix, extent(area), filename = file.path(ifolder,'crop',paste0(base,'_pixel_qa_crop.tif')), overwrite = T)
crop(radsat, extent(area), filename = file.path(ifolder,'crop',paste0(base,'_radsat_qa_crop.tif')), overwrite = T)
crop(atmos, extent(area), filename = file.path(ifolder,'crop',paste0(base,'_sr_atmos_opacity_crop.tif')), overwrite = T)
crop(cloud, extent(area), filename = file.path(ifolder,'crop',paste0(base,'_sr_cloud_qa_crop.tif')), overwrite = T)
rm(rst4, rst7,pix, radsat, atmos, cloud)
getwd()
library(devtools)
install()
knitr::opts_chunk$set(echo = TRUE, eval=T)
library(raster)
library(ff)
library(UpscaleRecovery)
library(bfast)
library(strucchange)
library(lubridate)
ifolder <- '/inst/extdata/'# 'C:\\Users\\keers001\\OneDrive\ -\ WageningenUR\\RETURN\\Data\\RETURN\\20200107_Upscaling\\CaseStudy\\Data\\' # directory with NBR data
ofolder <- '/inst/extdata/' # 'C:\\Users\\keers001\\OneDrive\ -\ W
# landsat 7
fls <- list.files(ifolder, pattern = 'LE07*')
fls <- list.files(ifolder)
getwd()
ifolder <- './inst/extdata/'# 'C:\\Users\\keers001\\OneDrive\ -\ WageningenUR\\RETURN\\Data\\RETURN\\20200107_Upscaling\\CaseStudy\\Data\\' # directory with NBR data
fls <- list.files(ifolder)
# landsat 7
fls <- list.files(ifolder, pattern = 'LE07*')
# landsat 7
fls <- list.files(ifolder, pattern = 'LE07*')
fls <- list.files(ifolder)
# landsat 7
fls <- list.files(ifolder, pattern = 'LE07*')
# landsat 7
fls <- list.files(ifolder, pattern = 'LE07*')
ifolder
# landsat 7
fls <- list.files(ifolder, pattern = 'LE07')
# landsat 7
fls <- list.files(ifolder, pattern = 'LE07*')
# landsat 7
fls <- list.files(ifolder, pattern = 'LE07*.tif')
# landsat 7
fls <- list.files(ifolder, pattern = '*.tif')
# landsat 7
fls <- list.files(ifolder, pattern = '*')
# landsat 7
fls <- list.files(ifolder, pattern = '')
# landsat 7
fls <- list.files(ifolder, pattern ='LE07*')
fls <- list.files(ifolder)
fls
fls <- list.files(ifolder, pattern ='LE07*')
# landsat 7
fls <- list.files(ifolder, pattern ='LE07*')
fls <- list.files(ifolder, pattern ='LE07*')
# landsat 7
fls <- list.files(ifolder, pattern ='LE07*')
fls <- list.files(ifolder, pattern ='LE07*')
# landsat 7
fls <- list.files(ifolder, pattern ='LE07*7_cro.tif')
fls <- list.files(ifolder, pattern ='LE07*7_crop.tif')
fls <- list.files(ifolder, pattern ='LE07*7_crop.tif')
fls <- list.files(ifolder, pattern ='LE07*')
fls <- list.files(ifolder, pattern ='LE07*.tif')
fls <- list.files(ifolder, pattern ='LE07*tif')
fls <- list.files(ifolder, pattern ='LE07*[n].tif')
# landsat 7
fls <- list.files(ifolder, pattern ='LE07[:alnum:]*7_crop.tif')
fls <- list.files(ifolder, pattern ='LE07[:alnum:]*7_crop.tif')
# landsat 7
fls <- list.files(ifolder, pattern ='LE07([:alnum:][:punct:])*7_crop.tif')
fls <- list.files(ifolder, pattern ='LE07([:alnum:][:punct:])*7_crop.tif')
# landsat 7
fls <- list.files(ifolder, pattern ='LE07.*7_crop.tif')
fls <- list.files(ifolder, pattern ='LE07.*7_crop.tif')
ifolder <- '../inst/extdata/'# 'C:\\Users\\keers001\\OneDrive\ -\ WageningenUR\\RETURN\\Data\\RETURN\\20200107_Upscaling\\CaseStudy\\Data\\' # directory with NBR data
# landsat 7
fls <- list.files(ifolder, pattern ='LE07.*7_crop.tif')
# landsat 5
fls <- list.files(ifolder, pattern ='LC05.*7_crop.tif')
# landsat 5
fls <- list.files(ifolder, pattern ='LT05.*7_crop.tif')
B7 <- stack(fls)
B7 <- stack(file.path(ifolder,fls))
# landsat 5
B7 <- stack(file.path(ifolder,list.files(ifolder, pattern ='LT05.*7_crop.tif')))# stack the raster layers
B4 <- stack(file.path(ifolder,list.files(ifolder, pattern ='LT04.*7_crop.tif')))# stack the raster layers
B5 <- stack(file.path(ifolder,list.files(ifolder, pattern ='LT05.*5_crop.tif')))# stack the raster layers
B4 <- stack(file.path(ifolder,list.files(ifolder, pattern ='LT05.*4_crop.tif')))# stack the raster layers
NBR <- (B7 - B4)/(B7 + B4)
NBR
NBR <- (B4 - B7)/(B7 + B4)
pix <- stack(file.path(ifolder,list.files(ifolder, pattern ='_pixel_qa_crop.tif')))
radsat <- stack(file.path(ifolder,list.files(ifolder, pattern ='_radsat_qa_crop.tif')))
atmos <- stack(file.path(ifolder,list.files(ifolder, pattern ='_sr_atmos_opacity_crop.tif')))
cloud <- stack(file.path(ifolder,list.files(ifolder, pattern ='_sr_cloud_qa_crop.tif')))
decimals <- c(3,5,11,4)
m <- sapply(decimals,function(x){ as.integer(intToBits(x))})
m
rm(B7, B4)
decimals <- 4
m <- sapply(decimals,function(x){ as.integer(intToBits(x))})
m
plot(cloud[1])
plot(cloud[[1]])
c(1,9,2,34,4,12,20,36,52,8,12,24)
cld <- c(1,9,2,34,4,12,20,36,52,8,12,24,40,56,16,20,24,32)
vals <- 1:18
cld <- c(1,9,2,34,4,12,20,36,52,8,12,24,40,56,16,20,24,32)
m <- sapply(cld,function(x){ as.integer(intToBits(x))})
m[1,]
m[2,]
m[3,]
vals[(m[2,] == 1) || (m[3,] == 1) || (m[4,] == 1) || (m[5,] == 1)] <- NA
vals
vals[(m[2,] == 1) | (m[3,] == 1) | (m[4,] == 1) | (m[5,] == 1)] <- NA
vals
vals[(m[2,] == 1) | (m[3,] == 1) | (m[4,] == 1) | (m[5,] == 1) | (m[6,] == 1)] <- NA
vals
plot(pix[[1]])
plot(pix[[1]])
plot(pix[[1]])
plot(pix[[1]])
plot(pix[[1]])
plot(cloud[[1]])
plot(cloud[[1]])
px <- c(1,9,2,34,4,12,20,36,52,8,12,24,40,56,16,20,24,32)
# QA_PIXEL mask: fill (bit 0), dilated cloud (bit 1) and high confidence (bit 8-9), cloud (bit 3) and high confidence (bit 8-9), cloud shadow (bit 4)
m <- sapply(px,function(x){ as.integer(intToBits(x))})
(m[c(9,10),]
)
list.files(ifolder, pattern ='LT05.*7_crop.tif')
dts <- stringr::str_split(list.files(ifolder, pattern ='LT05.*7_crop.tif'), pattern = '_')
dts
?strsplit
unlist(stringr::str_split(list.files(ifolder, pattern ='LT05.*7_crop.tif'), pattern = '_'))
lapply(stringr::str_split(list.files(ifolder, pattern ='LT05.*7_crop.tif'), pattern = '_'),function(x) x[[4]])
unlist(lapply(stringr::str_split(list.files(ifolder, pattern ='LT05.*7_crop.tif'), pattern = '_'),function(x) x[[4]]))
as.Date(unlist(lapply(stringr::str_split(list.files(ifolder, pattern ='LT05.*7_crop.tif'), pattern = '_'),function(x) x[[4]])), format = "%Y%m%d")
library(raster)
ifolder <- 'C:\\Users\\keers001\\OneDrive - WageningenUR\\RETURN\Data\\RETURN\\CCI_fire\\Original'
ofolder <- 'C:\\Users\\keers001\\Dropbox\\output\\Script_R\\UpscaleRecovery\\inst\\extdata'
fls <- list.files(ifolder, pattern ='*-CL.tif')
ifolder <- 'C:\\Users\\keers001\\OneDrive - WageningenUR\\RETURN\Data\\RETURN\\CCI_fire\\Original'
ofolder <- 'C:\\Users\\keers001\\Dropbox\\output\\Script_R\\UpscaleRecovery\\inst\\extdata'
ifolder <- 'C:\\Users\\keers001\\OneDrive - WageningenUR\\RETURN\\Data\\RETURN\\CCI_fire\\Original'
fls <- list.files(ifolder, pattern ='*-CL.tif')
216/12
i <-1
tools::file_path_sans_ext(file.path(ifolder, fls[i]))
tools::file_path_sans_ext(fls[i])
rst <- raster(file.path(ifolder,fls[i]))
plot(rst)
area <- raster('C:\\Users\\keers001\\OneDrive - WageningenUR\\RETURN\\Data\\RETURN\\20200107_Upscaling\\CaseStudy\\Data\\LSTS_SantaRem_area4_2000_2020.tif')
area
rst
extent(area)
tst <- crop(rst, extent(area), filename = file.path(ofolder,paste0(base,'_crop.tif')), overwrite = T)
base <- tools::file_path_sans_ext(fls[i])
rst <- raster(file.path(ifolder,fls[i]))
tst <- crop(rst, extent(area), filename = file.path(ofolder,paste0(base,'_crop.tif')), overwrite = T)
plot(tst)
tst
area
rst
fls <- list.files(ifolder, pattern ='*-CL.tif')
for(i in 1:length(fls)){
base <- tools::file_path_sans_ext(fls[i])
rst <- raster(file.path(ifolder,fls[i]))
tst <- crop(rst, extent(area), filename = file.path(ofolder,paste0(base,'_crop.tif')), overwrite = T)
}
library(raster)
ifolder <- 'C:\\Users\\keers001\\OneDrive - WageningenUR\\RETURN\\Data\\RETURN\\MapBiomas'
ofolder <- 'C:\\Users\\keers001\\Dropbox\\output\\Script_R\\UpscaleRecovery\\inst\\extdata'
area <- raster('C:\\Users\\keers001\\OneDrive - WageningenUR\\RETURN\\Data\\RETURN\\20200107_Upscaling\\CaseStudy\\Data\\LSTS_SantaRem_area4_2000_2020.tif')
extent(area)
rst <- raster(file.path(ifolder, 'COLECAO_4_1_CONSOLIDACAO_amazonia.tif'))
rst
plot(rst)
tst <- crop(rst, extent(area), filename = file.path(ofolder,'COLECAO_4_1_CONSOLIDACAO_amazonia_crop.tif'), overwrite = T)
plot(tst)
rst <- stack(file.path(ifolder, 'COLECAO_4_1_CONSOLIDACAO_amazonia.tif'))
rst
tst <- crop(rst, extent(area), filename = file.path(ofolder,'COLECAO_4_1_CONSOLIDACAO_amazonia_crop.tif'), overwrite = T)
plot(tst)
tst <- crop(rst, extent(area), filename = file.path(ofolder,'COLECAO_4_1_CONSOLIDACAO_amazonia_crop.tif'), overwrite = T)
plot(tst[[1]])
tst <- crop(rst, extent(area), filename = file.path(ofolder,'COLECAO_4_1_CONSOLIDACAO_amazonia_crop.tif'), overwrite = T)
plot(tst[[1]])
plot(tst[[1]])
plot(tst[[2]])
tst
plot(tst[[2]])
plot(tst[1])
plot(tst[[1]])
tst <- crop(rst, extent(area), filename = file.path(ofolder,'COLECAO_4_1_CONSOLIDACAO_amazonia_crop.tif'), overwrite = T)
plot(tst[[1]])
plot(tst[[34]])
rst
length(1985:2018)
unique(tst[[34]])
unique(tst[[1]])
ifolder <- 'C:\\Users\\keers001\\OneDrive - WageningenUR\\RETURN\\Data\\RETURN\\Hansen'
ofolder <- 'C:\\Users\\keers001\\Dropbox\\output\\Script_R\\UpscaleRecovery\\inst\\extdata'
area <- raster('C:\\Users\\keers001\\OneDrive - WageningenUR\\RETURN\\Data\\RETURN\\20200107_Upscaling\\CaseStudy\\Data\\LSTS_SantaRem_area4_2000_2020.tif')
extent(area)
rst <- stack(file.path(ifolder, 'Hansen_GFC-2018-v1.6_treecover2000_00N_060W.tif'))
ifolder <- 'C:\\Users\\keers001\\OneDrive - WageningenUR\\RETURN\\Data\\RETURN\\Hansen'
rst <- stack(file.path(ifolder, 'Hansen_GFC-2018-v1.6_treecover2000_00N_060W.tif'))
rst
tst <- crop(rst, extent(area), filename = file.path(ofolder,'Hansen_GFC-2018-v1.6_treecover2000_crop.tif'), overwrite = T)
plot(tst[[1]])
rst <- stack(file.path(ifolder, 'Hansen_GFC-2018-v1.6_lossyear_00N_060W.tif'))
tst <- crop(rst, extent(area), filename = file.path(ofolder,'Hansen_GFC-2018-v1.6_lossyear_crop.tif'), overwrite = T)
plot(tst[[1]])
rst <- stack(file.path(ifolder, 'Hansen_GFC-2018-v1.6_datamask_00N_060W.tif'))
tst <- crop(rst, extent(area), filename = file.path(ofolder,'Hansen_GFC-2018-v1.6_datamask_crop.tif'), overwrite = T)
plot(tst[[1]])
rst
rst <- stack(file.path(ifolder, 'Hansen_GFC-2018-v1.6_lossyear_00N_060W.tif'))
rst
knitr::opts_chunk$set(echo = TRUE, eval=T)
library(raster)
library(ff)
library(UpscaleRecovery)
library(bfast)
library(strucchange)
library(lubridate)
firefolder <- '../inst/extdata/' # 'C:\\Users\\keers001\\OneDrive - WageningenUR\\RETURN\\Data\\RETURN\\CCI_fire\\' #'\\\\WURNET.NL\\Homes\\keers001\\AppData\\FolderRedirection\\Desktop\\cci_fire2\\'
ifolder <- '../inst/extdata/'# 'C:\\Users\\keers001\\OneDrive\ -\ WageningenUR\\RETURN\\Data\\RETURN\\20200107_Upscaling\\CaseStudy\\Data\\' # directory with NBR data
# one landsat tile (to extract the raster properties)
rst <- raster(file.path(ifolder, 'LC08_L1TP_225064_20170821_20170911_01_T1_sr_band7_crop.tif'))
rst
rst <- raster(file.path(ifolder, 'LC08_L1TP_225064_20170821_20170911_01_T1_sr_band7_crop.tif'))
# MapBiomas land cover
COLECAO_4_1_CONSOLIDACAO_amazonia_crop
# one landsat tile (to extract the raster properties)
rst <- raster(file.path(ifolder, 'LC08_L1TP_225064_20170821_20170911_01_T1_sr_band7_crop.tif'))
# MapBiomas land cover
lc <- stack(file.path(ifolder, 'COLECAO_4_1_CONSOLIDACAO_amazonia_crop.tif'))
# Hansen land cover
han_msk <- raster(file.path(ifolder, 'Hansen_GFC-2018-v1.6_datamask_crop.tif'))
han_loss <- raster(file.path(ifolder, 'Hansen_GFC-2018-v1.6_lossyear_crop.tif'))
han_cov <- raster(file.path(ifolder, 'Hansen_GFC-2018-v1.6_treecover2000_crop.tif'))
# Fire data
fcl <- stack(file.path(ifolder,list.files(ifolder, pattern ='*CL_crop.tif')))# stack the raster layers of band 5
fjd <- stack(file.path(ifolder,list.files(ifolder, pattern ='*JD_crop.tif')))# stack the raster layers of band 5
fcl
length(1985:2018)
as.Date(1985:2018, format = '%Y')
as.Date(c(1985:2018), format = '%Y')
as.Date(paste0(1985:2018, '-01-01'), format = '%Y-%m-%d')
names(lc) <- as.Date(paste0(1985:2018, '-01-01'), format = '%Y-%m-%d')
startyr <- 2000
endyr <- 2018
startyr <- as.Date('2000-01-01') # start year
startyr
startyr <- as.Date('1999-01-01') # start date
endyr <- as.Date('2018-12-31') # end date
which((dtslc >= startyr) & (dtslc <= endyr))
dtslc <- as.Date(paste0(1985:2018, '-01-01'), format = '%Y-%m-%d')
which((dtslc >= startyr) & (dtslc <= endyr))
lc <- stack(file.path(ifolder, 'COLECAO_4_1_CONSOLIDACAO_amazonia_crop.tif'))
dtslc <- as.Date(paste0(1985:2018, '-01-01'), format = '%Y-%m-%d')
names(lc) <- dtslc
lc <- lc[which((dtslc >= startyr) & (dtslc <= endyr))]
lc
lc <- stack(file.path(ifolder, 'COLECAO_4_1_CONSOLIDACAO_amazonia_crop.tif'))
dtslc <- as.Date(paste0(1985:2018, '-01-01'), format = '%Y-%m-%d')
names(lc) <- dtslc
lc <- lc[[which((dtslc >= startyr) & (dtslc <= endyr))]]
lc
names(fcl)
as.Date(names(fcl), format = "X%Y%m%d.ESACCI.L3S_FIRE.BA.MODIS.AREA_2.fv5.1.CL_crop")
fdts<- as.Date(names(fcl), format = "X%Y%m%d.ESACCI.L3S_FIRE.BA.MODIS.AREA_2.fv5.1.CL_crop") # dates associated with the fire data stack
names(fcl) <- fdts
names(fjd) <- fdts
fcl <- stack(file.path(ifolder,list.files(ifolder, pattern ='*CL_crop.tif')))# stack the raster layers of band 5
fjd <- stack(file.path(ifolder,list.files(ifolder, pattern ='*JD_crop.tif')))# stack the raster layers of band 5
fjd <- stack(file.path(ifolder,list.files(ifolder, pattern ='*JD_crop.tif')))# stack the raster layers of band 5
fdts<- as.Date(names(fcl), format = "X%Y%m%d.ESACCI.L3S_FIRE.BA.MODIS.AREA_2.fv5.1.CL_crop") # dates associated with the fire data stack
names(fcl) <- fdts
fcl <- fcl[[which((fdts >= startyr) & (fdts <= endyr))]]
?projectRaster
fcl30 <- resample(fcl, rst, method="ngb")#resample to 30 m spatial resolution
# crop and change spatial resolution of fire stack
# fcl30 <- crop(fcl,extent(rst))# change extent of the image stack
fcl30 <- projectRaster(fcl, crs = CRS(rst))
CRS(rst)
# crop and change spatial resolution of fire stack
# fcl30 <- crop(fcl,extent(rst))# change extent of the image stack
fcl30 <- projectRaster(fcl, crs = crs(rst))
lc
fcl30
rst
fcl30 <- resample(fcl30, rst, method="ngb")#resample to 30 m spatial resolution
fcl30
lc30 <- projectRaster(lc, crs = crs(rst))
lc30 <- resample(lc30, rst, method="ngb")
plot(lc30[[1]])
plot(lc30[[20]])
han_cov[han_msk == 0] <- NA
rm(han_msk)
han_cov
han30 <- projectRaster(han_cov, crs = crs(rst))
han30 <- resample(han30, rst, method="ngb")
plot(han30)
tst <- ((msk==9) | ((msk >= 14) & (msk<= 22)) | (msk >= 24))
msk <- lc30
tst <- ((msk==9) | ((msk >= 14) & (msk<= 22)) | (msk >= 24))
plot(tst[[1]])
plot(tst[[10]])
plot(tst[[30]])
plot(tst[[20]])
plot(sum(tst))
(
tst <- sum(tst)
plot(tst)
msk <- lc30
msk <- ((msk==9) | ((msk >= 14) & (msk<= 22)) | (msk >= 24))
msk <- sum(msk)
msk <- (msk == 0)
plot(msk)
msklc <- lc30
msklc <- ((msklc==9) | ((msklc >= 14) & (msklc<= 22)) | (msklc >= 24))
msklc <- sum(msklc)
msklc <- (msklc == 0)
plot(msklc)
names(llc)
names(lc)
# select areas that were forested in 2000
mskfor <- (lc30$X2000.01.01 < 6)
plot(mskfor)
# select areas with tree cover larger than 80%
mskcov <- (han30 > 80)
plot(mskcov)
# total mask
msk <- ((msklc ==1) & (mskfor == 1) & (mskcov == 1))
plot(msk)
tsFire <- calc(stack(msk,fcl30, fjd30), function(x){createFireStack(x, dts = fdts, resol = tempRes, thres = 95)}, filename = paste0(ofolder, tsfile, '_Fire_', tempRes),overwrite=TRUE)
library(raster)
ifolder <- 'C:\\Users\\keers001\\OneDrive - WageningenUR\\RETURN\\Data\\RETURN\\CCI_fire\\Original'
ofolder <- 'C:\\Users\\keers001\\Dropbox\\output\\Script_R\\UpscaleRecovery\\inst\\extdata'
area <- raster('C:\\Users\\keers001\\OneDrive - WageningenUR\\RETURN\\Data\\RETURN\\20200107_Upscaling\\CaseStudy\\Data\\LSTS_SantaRem_area4_2000_2020.tif')
extent(area)
fls <- list.files(ifolder, pattern ='*-JD.tif')
for(i in 1:length(fls)){
base <- tools::file_path_sans_ext(fls[i])
rst <- raster(file.path(ifolder,fls[i]))
crop(rst, extent(area), filename = file.path(ofolder,paste0(base,'_crop.tif')), overwrite = T)
}
ifolder <- '../inst/extdata/'# 'C:\\Users\\keers001\\OneDrive\ -\ WageningenUR\\RETURN\\Data\\RETURN\\20200107_Upscaling\\CaseStudy\\Data\\' # directory with NBR data
ofolder <- '../inst/extdata/' # 'C:\\Users\\keers001\\OneDrive\ -\ W
# one landsat tile (to extract the raster properties)
rst <- raster(file.path(ifolder, 'LC08_L1TP_225064_20170821_20170911_01_T1_sr_band7_crop.tif'))
fjd <- stack(file.path(ifolder,list.files(ifolder, pattern ='*JD_crop.tif')))# stack the raster layers of band 5
fjd <- stack(file.path(ifolder,list.files(ifolder, pattern ='*JD_crop.tif')))# stack the raster layers of band 5
names(fjd) <- fdts
fjd <- fcl[[which((fdts >= startyr) & (fdts <= endyr))]]
fjd30 <- projectRaster(fjd, crs = crs(rst))
fjd30 <- resample(fjd30, rst, method="ngb")
tsFire <- calc(stack(msk,fcl30, fjd30), function(x){createFireStack(x, dts = fdts, resol = tempRes, thres = 95)}, filename = paste0(ofolder, tsfile, '_Fire_', tempRes),overwrite=TRUE)
tempRes <- 'monthly' # daily, annual, monthly, or quart (yearly data not supported yet!)
tsFire <- calc(stack(msk,fcl30, fjd30), function(x){createFireStack(x, dts = fdts, resol = tempRes, thres = 95)}, filename = paste0(ofolder, tsfile, '_Fire_', tempRes),overwrite=TRUE)
createFireStack(stack(msk,fcl30, fjd30)[1:5], dts = fdts, resol = tempRes, thres = 95)
! F
install()
tsFire <- calc(stack(msk,fcl30, fjd30), function(x){createFireStack(x, dts = fdts, resol = tempRes, thres = 95)}, filename = paste0(ofolder, tsfile, '_Fire_', tempRes),overwrite=TRUE)
tsFire <- calc(stack(msk,fcl30, fjd30), function(x){createFireStack(x, dts = fdts, resol = tempRes, thres = 95)}, overwrite=TRUE)#filename = paste0(ofolder, tsfile, '_Fire_', tempRes)
rm(fcl, fjd, fcl30, fjd30)
# # update mask with locations that experienced fire
freloc <- (sum(tsFire) > 0) # areas that have experienced a fire get the value 1, other areas the value 0
rm(msklc, mskfor, mskcov)
plot(freloc)
plot(sum(tsFire))
tsFire
dtsfr <- as.Date(toRegularTS(fdts, fdts, fun='max', resol = tempRes))
dtsfr <- rollback(dtsfr, roll_to_first = TRUE, preserve_hms = TRUE)
names(tsFire) <- fdts
names(tsFire) <- dtsfr
tsFire
Which(freloc == 1)
Which(freloc == 1)
?Which
Which(freloc == 1, cells = T)
dtsfr
# landsat 7
B7 <- stack(file.path(ifolder,list.files(ifolder, pattern ='LE07.*7_crop.tif')))# stack the raster layers of band 5
B4 <- stack(file.path(ifolder,list.files(ifolder, pattern ='LE07.*4_crop.tif')))
pix <- stack(file.path(ifolder,list.files(ifolder, pattern ='LE07.*_pixel_qa_crop.tif')))
radsat <- stack(file.path(ifolder,list.files(ifolder, pattern ='LE07.*_radsat_qa_crop.tif')))
cloud <- stack(file.path(ifolder,list.files(ifolder, pattern ='LE07.*_sr_cloud_qa_crop.tif')))
dts7 <- as.Date(unlist(lapply(stringr::str_split(list.files(ifolder, pattern ='LE07.*7_crop.tif'), pattern = '_'),function(x) x[[4]])), format = "%Y%m%d")# get the dates of each layer
NBR <- calcNBR(B4,B7) # calculate NBR
document()
install()
knitr::opts_chunk$set(echo = TRUE, eval=T)
# one landsat tile (to extract the raster properties)
rst <- raster(file.path(ifolder, 'LC08_L1TP_225064_20170821_20170911_01_T1_sr_band7_crop.tif'))
## Set default directory for user installed packages
.libPaths(c("C:\\Users\\keers001\\OneDrive - WageningenUR\\R", .libPaths()[2]))
library(raster)
# one landsat tile (to extract the raster properties)
rst <- raster(file.path(ifolder, 'LC08_L1TP_225064_20170821_20170911_01_T1_sr_band7_crop.tif'))
knitr::opts_chunk$set(echo = TRUE, eval=T)
library(raster)
library(ff)
library(UpscaleRecovery)
library(bfast)
library(strucchange)
library(lubridate)
ifolder <- '../inst/extdata/'# 'C:\\Users\\keers001\\OneDrive\ -\ WageningenUR\\RETURN\\Data\\RETURN\\20200107_Upscaling\\CaseStudy\\Data\\' # directory with NBR data
ofolder <- '../inst/extdata/' # 'C:\\Users\\keers001\\OneDrive\ -\ WageningenUR\\RETURN\\Data\\RETURN\\20200107_Upscaling\\CaseStudy\\Test\\' # directory where the recovery indicators and temporary outputs will be saved
startyr <- as.Date('1999-01-01') # start date
endyr <- as.Date('2019-12-31') # end date
tempRes <- 'monthly' # daily, annual, monthly, or quart (yearly data not supported yet!)
tempFun <- 'max' # max or mean (function used for temporal aggregation of data)
timeThres <- 2 # in case of segmentations, the time period between the detected break and the disturbance should be less than timeThres years
slpThres <- 2 # the slope of the pre-disturbance period should be less than slpThres
#
# one landsat tile (to extract the raster properties)
rst <- raster(file.path(ifolder, 'LC08_L1TP_225064_20170821_20170911_01_T1_sr_band7_crop.tif'))
# extend the fire data time span
tst <- raster(rst,band =3)
# extend the fire data time span
tst <- raster(rst,3)
# extend the fire data time span
tst <- stack(rst,3)
tst
tst[] <- NA
plot(tst)
# extend the fire data time span
tst <- stack(rep(rst,3))
dtstot <- as.Date(toRegularTS(startyr, endyr, fun='max', resol = tempRes))
dtstot <- as.Date(toRegularTS(c(startyr, endyr), c(startyr, endyr), fun='max', resol = tempRes))
toRegularTS(c(startyr, endyr), c(startyr, endyr), fun='max', resol = tempRes)
z <- zoo(c(startyr, endyr), c(startyr, endyr))
z
as.ts(aggregate(z, as.yearmon, mmax))
(aggregate(z, as.yearmon, mmax))
